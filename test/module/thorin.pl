#============================================================================================================
#
#	出力管理モジュール(THORIN)
#	thorin.pl
#	---------------------------------------------
#	2002.12.05 start
#
#============================================================================================================
package	THORIN;

use strict;
use warnings;

#------------------------------------------------------------------------------------------------------------
#
#	モジュールコンストラクタ - new
#	-------------------------------------------
#	引　数：なし
#	戻り値：モジュールオブジェクト
#
#------------------------------------------------------------------------------------------------------------
sub new
{
	my $this = shift;
	my (@BUFF, $obj);
	
	$obj = {				# thorinオブジェクト
		'BUFF'	=> \@BUFF,	# 出力バッファ
	};
	bless $obj, $this;
	
	return $obj;
}

#------------------------------------------------------------------------------------------------------------
#
#	バッファ出力 - Print
#	-------------------------------------------
#	引　数：$line : 出力テキスト
#	戻り値：なし
#
#------------------------------------------------------------------------------------------------------------
sub Print
{
	my $this = shift;
	my ($line) = @_;
	
	push @{$this->{'BUFF'}}, $line;
}

#------------------------------------------------------------------------------------------------------------
#
#	INPUTタグ出力 - HTMLInput
#	-------------------------------------------
#	引　数：$kind  : タイプ
#			$name  : 名前
#			$value : 値
#	戻り値：なし
#
#------------------------------------------------------------------------------------------------------------
sub HTMLInput
{
	my $this = shift;
	my ($kind, $name, $value) = @_;
	my $line;
	
	$line = "<input type=$kind name=\"$name\" value=\"$value\">\n";
	
	push @{$this->{'BUFF'}}, $line;
}

#------------------------------------------------------------------------------------------------------------
#
#	バッファフラッシュ - Flush
#	-------------------------------------------
#	引　数：$flag       : 出力フラグ
#			$perm		: パーミッション
#			$szFilePath : 出力パス
#	戻り値：なし
#
#------------------------------------------------------------------------------------------------------------
sub Flush
{
	my $this = shift;
	my ($flag, $perm, $szFilePath) = @_;
	
	# ファイルへ出力
	if ($flag) {
		eval {
			open OUTPUT, "+> $szFilePath";
			flock OUTPUT, 2;
			truncate OUTPUT, 0;
			seek OUTPUT, 0, 0;
			print OUTPUT @{$this->{'BUFF'}};
			close OUTPUT;
			chmod $perm, $szFilePath;
		};
	}
	# 標準出力に出力
	else {
		print @{$this->{'BUFF'}};
	}
}

#------------------------------------------------------------------------------------------------------------
#
#	バッファクリア - Clear
#	-------------------------------------------
#	引　数：なし
#	戻り値：なし
#
#------------------------------------------------------------------------------------------------------------
sub Clear
{
	my $this = shift;
	
	undef @{$this->{'BUFF'}};
}

#------------------------------------------------------------------------------------------------------------
#
#	マージ - Merge
#	-------------------------------------------
#	引　数：$thorin : THORINモジュール
#	戻り値：なし
#
#------------------------------------------------------------------------------------------------------------
sub Merge
{
	my $this = shift;
	my ($thorin) = @_;
	
	foreach (@{$thorin->{'BUFF'}}) {
		push @{$this->{'BUFF'}}, $_;
	}
}

#============================================================================================================
#	モジュール終端
#============================================================================================================
1;
