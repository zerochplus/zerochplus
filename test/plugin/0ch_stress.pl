#============================================================================================================
#
#	拡張機能 - 特殊強調表示機能
#	0ch_stress.pl
#	---------------------------------------------------------------------------
#	2005.02.19 start
#
#============================================================================================================
package ZPL_stress;

#------------------------------------------------------------------------------------------------------------
#
#	コンストラクタ
#	-------------------------------------------------------------------------------------
#	@param	なし
#	@return	オブジェクト
#
#------------------------------------------------------------------------------------------------------------
sub new
{
	my		$this = shift;
	my		$obj={};
	bless($obj,$this);
	return $obj;
}

#------------------------------------------------------------------------------------------------------------
#
#	拡張機能名称取得
#	-------------------------------------------------------------------------------------
#	@param	なし
#	@return	名称文字列
#
#------------------------------------------------------------------------------------------------------------
sub getName
{
	my	$this = shift;
	return '特殊強調表\示機能\';
}

#------------------------------------------------------------------------------------------------------------
#
#	拡張機能説明取得
#	-------------------------------------------------------------------------------------
#	@param	なし
#	@return	説明文字列
#
#------------------------------------------------------------------------------------------------------------
sub getExplanation
{
	my	$this = shift;
	return '先頭に ＞,＃,# の付いた行を強調表\示します。';
}

#------------------------------------------------------------------------------------------------------------
#
#	拡張機能タイプ取得
#	-------------------------------------------------------------------------------------
#	@param	なし
#	@return	拡張機能タイプ(スレ立て:1,レス:2,read:4,index:8)
#
#------------------------------------------------------------------------------------------------------------
sub getType
{
	my	$this = shift;
	return (1 | 2);
}

#------------------------------------------------------------------------------------------------------------
#
#	拡張機能実行インタフェイス
#	-------------------------------------------------------------------------------------
#	@param	$sys	MELKOR
#	@param	$form	SAMWISE
#	@return	正常終了の場合は0
#
#------------------------------------------------------------------------------------------------------------
sub execute
{
	my	$this = shift;
	my	($sys,$form) = @_;
	
	my $content = $form->Get('MESSAGE');
	STRESS(\$content);
	$form->Set('MESSAGE',$content);
	
	return 0;
}

#------------------------------------------------------------------------------------------------------------
#
#	特殊強調表示
#	-------------------------------------------------------------------------------------
#	@param	$text	対象文字列
#	@return	なし
#
#------------------------------------------------------------------------------------------------------------
sub STRESS
{
	my	($text) = @_;
	
	$$text = '<br>' . $$text . '<br>';
	
	# ＞引用変換
	while($$text =~ /<br>＞(.*?)<br>/){
		$$text =~ s/<br>＞(.*?)<br>/<br><font color=gray>＞$1<\/font><br>/;
	}
	# ＃引用変換
	while($$text =~ /<br>＃(.*?)<br>/){
		$$text =~ s/<br>＃(.*?)<br>/<br><font color=green>＃$1<\/font><br>/;
	}
	# #引用変換
	while($$text =~ /<br>#(.*?)<br>/){
		$$text =~ s/<br>#(.*?)<br>/<br><font color=green>#$1<\/font><br>/;
	}
	
	# 最初につけた<br>を取り外す
	$$text = substr($$text,4,length($$text) - 8);
}

#============================================================================================================
#	Module END
#============================================================================================================
1;
